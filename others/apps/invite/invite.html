<template page>
  <l-m src="/packages/libs/jdenticon/jdent-icon.html"></l-m>
  <style>
    :host {
      display: block;
    }

    h1 {
      font-size: 20px;
    }
    .info {
      display: flex;
      margin-left: 8px;
      flex-direction: column;
      justify-content: center;
    }
  </style>
  <div>
    <h1>添加设备</h1>
    <div style="display: flex">
      <div>
        <jdent-icon
          :value="targetUserId"
          style="width: 60px; height: 60px"
        ></jdent-icon>
      </div>
      <div class="info">
        <div>用户名: {{userName}}</div>
        <div>UserID: {{targetUserId}}</div>
      </div>
    </div>
  </div>
  <script>
    export default async ({ load }) => {
      const { createUser } = await load("/packages/new-user/main.js");
      const user = await createUser();

      // 获取连接参数
      const params = new URLSearchParams(location.search);
      const targetUserId = params.get("userId"); // 对面设备的userId

      return {
        data: {
          targetUserId,
          userName: "",
        },
        proto: {
          async sendInvite() {
            const remoteUser = await user.connectUser({
              userId: targetUserId,
            });

            // 获取对方的用户卡片
            const info = await remoteUser.info();
            this.userName = info.name;
          },
        },
        attached() {
          this.sendInvite();
        },
        detached() {},
      };
    };
  </script>
</template>
