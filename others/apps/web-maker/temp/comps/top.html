<template component>
  <style>
    :host {
      display: flex;
      align-items: center;
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 50px;
      z-index: 2;
    }

    .lang-selector {
      margin: 0 16px 0 0;
      height: 26px;
    }

    .theme-toggle {
      margin: 0 16px 0 0;
      height: 26px;
      background: transparent;
      border: 1px solid var(--md-sys-color-normal40);
      border-radius: 4px;
      cursor: pointer;
      padding: 0 10px;
    }

    .theme-toggle:hover {
      background: var(--md-ref-palette-translucent-normal50);
    }

    .theme-dark-mode .theme-toggle {
      color: white;
      border-color: var(--md-sys-color-normal70);
    }

    .theme-dark-mode .theme-toggle:hover {
      background: var(--md-ref-palette-translucent-normal60);
    }
  </style>
  <button style="margin-left: auto;" class="theme-toggle" on:click="toggleTheme">ğŸŒ™</button>
  <select class="lang-selector" sync:value="currentLang" on:change="changeLang">
    <option value="cn">ä¸­æ–‡</option>
    <option value="en">English</option>
    <option value="ja">æ—¥æœ¬èª</option>
  </select>
  <script>
    export default async ({ load }) => {
      return {
        tag: "main-top",
        data: {
          currentLang: "",
        },
        proto: {
          changeLang(e) {
            const lang = e.target.value;

            localStorage.setItem("webmaker_currentLang", lang);
            location.reload();
          },
          // è®¾ç½®ä¸»é¢˜æ¨¡å¼çš„å…¬å…±æ–¹æ³•
          setThemeMode(isDark) {
            if (isDark) {
              // è®¾ç½®ä¸ºé»‘å¤œæ¨¡å¼
              document.documentElement.classList.remove("theme-light-mode");
              document.documentElement.classList.add("theme-dark-mode");
              localStorage.setItem("webmaker_isDarkMode", "true");
              this.host.shadow.$("bg-one").setDayMode(false);
              // æ›´æ–°æŒ‰é’®æ˜¾ç¤º
              this.shadow.$(".theme-toggle").ele.textContent = "â˜€ï¸";
            } else {
              // è®¾ç½®ä¸ºç™½å¤©æ¨¡å¼
              document.documentElement.classList.remove("theme-dark-mode");
              document.documentElement.classList.add("theme-light-mode");
              localStorage.setItem("webmaker_isDarkMode", "false");
              this.host.shadow.$("bg-one").setDayMode(true);
              // æ›´æ–°æŒ‰é’®æ˜¾ç¤º
              this.shadow.$(".theme-toggle").ele.textContent = "ğŸŒ™";
            }
          },
          toggleTheme() {
            // è·å–å½“å‰æ˜¯å¦ä¸ºé»‘æš—æ¨¡å¼
            const isCurrentlyDark =
              document.documentElement.classList.contains("theme-dark-mode");

            // åˆ‡æ¢åˆ°ç›¸åçš„æ¨¡å¼
            this.setThemeMode(!isCurrentlyDark);
          },
        },
        attached() {
          setTimeout(() => {
            // åˆ¤æ–­å½“å‰ç³»ç»Ÿæ˜¯å¦é»‘å¤œæ¨¡å¼
            const isDarkMode =
              window.matchMedia &&
              window.matchMedia("(prefers-color-scheme: dark)").matches;

            let isDark = isDarkMode;
            // let isDark = false;
            if (localStorage.getItem("webmaker_isDarkMode")) {
              isDark = localStorage.getItem("webmaker_isDarkMode") === "true";
            }

            // ä½¿ç”¨å…¬å…±æ–¹æ³•è®¾ç½®ä¸»é¢˜
            this.setThemeMode(isDark);
          }, 100);
        },
      };
    };
  </script>
</template>
