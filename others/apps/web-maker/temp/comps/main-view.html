<template component>
  <l-m src="./block-view.html"></l-m>
  <style>
    :host {
      display: block;
      height: 100%;
    }
    .main {
      height: 100%;
      overflow-y: auto;
    }
    .top,
    .bottom {
      height: 30vh;
    }

    .que-block {
      max-width: 800px;
      margin: 0 auto;
      text-align: right;
    }

    @keyframes slideInFromRight {
      0% {
        transform: translateX(100%);
        opacity: 0;
      }
      100% {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .que-inner {
      display: inline-block;
      padding: 8px 16px;
      margin-right: 16px;
      border-radius: 16px;
      background-color: var(--md-sys-color-on-surface);
      color: var(--md-sys-color-surface);
      animation: slideInFromRight 0.3s ease; /* 添加动画效果 */
    }
  </style>
  <div class="main">
    <!-- <div class="top"></div> -->
    <o-fill :value="list">
      <div>
        <o-if :value="$data.aid">
          <block-view
            attr:aid="$data.aid"
            on:click-next="$host.clickNext($event)"
          ></block-view>
        </o-if>
        <o-else>
          <div class="que-block">
            <div class="que-inner">{{$data.question}}</div>
          </div>
        </o-else>
      </div>
    </o-fill>
    <div class="bottom"></div>
  </div>
  <script>
    export default async ({ load }) => {
      const { get } = await load("/packages/fs/main.js");

      return {
        tag: "main-view",
        data: {
          currentContentData: {},
          allArticleData: [],
          list: [],
        },
        proto: {
          clickNext({ data }) {
            this.list.push(
              {
                question: data.title,
              },
              {
                aid: data.aid,
              }
            );
          },
          async loadContentData() {
            const previewCacheFile = await get(
              "local/others/_web-marker-preview.json"
            );

            let previewData = await previewCacheFile.text();
            previewData = JSON.parse(previewData);
            this.allArticleData = previewData.list;

            const currentContent = previewData.list.find(
              (item) => item.aid === previewData.homeid
            );

            this.list = [
              {
                aid: currentContent.aid,
              },
            ];
          },
        },
        attached() {
          this.loadContentData();
        },
      };
    };
  </script>
</template>
