<template page>
  <l-m src="../comp/project-list.html"></l-m>
  <style>
    :host {
      display: block;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
    }
  </style>
  <div class="container">
    <h1>选择目标项目导出为网站</h1>
    <lumi-project-list on:select="selectProject"></lumi-project-list>
  </div>
  <script>
    export default async ({ load }) => {
      const { loadData } = await load("/packages/hybird-data/main.js");
      const { transArticle } = await load("../util/trans-article.js");
      const { get } = await load("/packages/fs/main.js");

      return {
        data: {},
        proto: {
          async selectProject({ data }) {
            console.log("data: ", data);

            // 加载全部的数据
            const projectData = await loadData({
              handle: await data._handle.get("article"),
              level: 100,
            });

            const article = await transArticle(projectData);

            // 保存到一个缓存文件夹上
            const cacheFile = await get(
              "local/others/_web-marker-preview.json",
              {
                create: "file",
              }
            );

            await cacheFile.write(JSON.stringify(article));
          },
        },
      };
    };
  </script>
</template>
