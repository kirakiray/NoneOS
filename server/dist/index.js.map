{"version":3,"file":"index.js","sources":["../src/websocket-server.js","../../packages/util/hash/get-hash.js","../../packages/crypto/crypto-ecdsa.js","../../packages/user/util/verify.js","../src/client-manager.js","../../packages/user/util/pack.js","../src/message-router.js","../src/client.js","../src/index.js"],"sourcesContent":["/**\n * WebSocket服务器类\n * 提供跨平台的WebSocket服务器实现，支持Bun和Node.js环境\n */\nexport class WebSocketServer {\n  /**\n   * 构造函数，初始化WebSocket服务器\n   * @param {Object} options - 配置选项\n   * @param {Function} options.onMessage - 消息处理函数\n   * @param {Function} options.onConnect - 连接处理函数\n   * @param {Function} options.onClose - 关闭处理函数\n   * @param {Function} options.onError - 错误处理函数\n   */\n  constructor(options = {}) {\n    this.wss = null;\n    this.server = null;\n\n    const { onMessage, onConnect, onClose, onError } = options;\n\n    if (typeof onMessage !== \"function\") {\n      throw new Error(\"onMessage 必须是一个函数\");\n    }\n\n    this.onMessage = onMessage;\n    this.onConnect = onConnect;\n    this.onClose = onClose;\n    this.onError = onError;\n  }\n\n  /**\n   * 启动WebSocket服务器\n   * @param {number} port - 监听端口\n   */\n  start(port = 8080) {\n    if (typeof Bun !== \"undefined\") {\n      this._startBunServer(port);\n    } else {\n      this._startNodeServer(port);\n    }\n  }\n\n  /**\n   * 启动Bun WebSocket服务器\n   * @param {number} port - 监听端口\n   */\n  _startBunServer(port) {\n    console.log(\"使用Bun原生WebSocket服务器\");\n\n    const websocketHandler = {\n      open: (ws) => {\n        if (this.onConnect) {\n          this.onConnect(ws);\n        }\n      },\n\n      message: (ws, data) => {\n        try {\n          if (this._isBinaryData(data)) {\n            this.onMessage(ws, data);\n            return;\n          }\n\n          const message = JSON.parse(data);\n          this.onMessage(ws, message);\n        } catch (error) {\n          console.error(\"处理消息时出错:\", error);\n          ws.send(JSON.stringify({ type: \"error\", message: \"消息格式错误\" }));\n        }\n      },\n\n      close: (ws, code, message) => {\n        if (this.onClose) {\n          this.onClose(ws, code, message);\n        }\n      },\n\n      error: (ws, error) => {\n        if (this.onError) {\n          this.onError(ws, error);\n        }\n      },\n    };\n\n    this.server = Bun.serve({\n      port: port,\n      fetch: (req, server) => {\n        if (server.upgrade(req)) {\n          return;\n        }\n        return new Response(\"无法找到该页面\", { status: 404 });\n      },\n      websocket: websocketHandler,\n    });\n\n    console.log(`Bun WebSocket服务器启动，监听端口 ${port}`);\n  }\n\n  /**\n   * 启动Node.js WebSocket服务器\n   * @param {number} port - 监听端口\n   */\n  async _startNodeServer(port) {\n    console.log(\"使用Node.js ws库\");\n\n    try {\n      const { WebSocketServer } = await import(\"ws\");\n\n      this.wss = new WebSocketServer({ port: port });\n      console.log(`WebSocket服务器启动，监听端口 ${port}`);\n\n      this.wss.on(\"connection\", (ws, req) => {\n        if (this.onConnect) {\n          this.onConnect(ws);\n        }\n\n        ws.on(\"message\", (data, isBinary) => {\n          try {\n            if (isBinary) {\n              this.onMessage(ws, data);\n              return;\n            }\n\n            const message = JSON.parse(data.toString());\n            this.onMessage(ws, message);\n          } catch (error) {\n            console.error(\"处理消息时出错:\", error);\n            ws.send(JSON.stringify({ type: \"error\", message: \"消息格式错误\" }));\n          }\n        });\n\n        ws.on(\"close\", (code, reason) => {\n          if (this.onClose) {\n            this.onClose(ws, code, reason);\n          }\n        });\n\n        ws.on(\"error\", (err) => {\n          if (this.onError) {\n            this.onError(ws, err);\n          }\n        });\n      });\n    } catch (error) {\n      console.error(\"无法加载ws库:\", error);\n    }\n  }\n\n  /**\n   * 判断是否为二进制数据\n   * @param {*} data - 待判断的数据\n   * @returns {boolean} 是否为二进制数据\n   */\n  _isBinaryData(data) {\n    return (\n      data instanceof ArrayBuffer ||\n      data instanceof Uint8Array ||\n      data instanceof Buffer ||\n      (typeof data !== \"string\" && !(data instanceof String))\n    );\n  }\n\n  /**\n   * 停止WebSocket服务器\n   */\n  stop() {\n    if (typeof Bun !== \"undefined\" && this.server) {\n      this.server.stop();\n      console.log(\"Bun WebSocket服务器已停止\");\n    } else if (this.wss) {\n      this.wss.close();\n      console.log(\"Node.js WebSocket服务器已停止\");\n    }\n  }\n}\n","export const getHash = async (data) => {\n  if (!globalThis.crypto) {\n    // Node.js 环境\n    const crypto = await import(\"crypto\");\n    if (typeof data === \"string\") {\n      data = new TextEncoder().encode(data);\n    } else if (data instanceof Blob) {\n      data = await data.arrayBuffer();\n    }\n    const hash = crypto.createHash(\"sha256\");\n    hash.update(Buffer.from(data));\n    return hash.digest(\"hex\");\n  } else {\n    // 浏览器环境\n    if (typeof data === \"string\") {\n      data = new TextEncoder().encode(data);\n    } else if (data instanceof Blob) {\n      data = await data.arrayBuffer();\n    }\n    const hash = await crypto.subtle.digest(\"SHA-256\", data);\n    const hashArray = Array.from(new Uint8Array(hash));\n    const hashHex = hashArray\n      .map((bytes) => bytes.toString(16).padStart(2, \"0\"))\n      .join(\"\");\n    return hashHex;\n  }\n};\n","/**\n * ECDSA 签名相关工具函数\n */\n\n/**\n * 生成 ECDSA 密钥对\n * @returns {Promise<{publicKey: string, privateKey: string}>} 包含公钥和私钥的 base64 字符串\n */\nexport async function generateKeyPair() {\n  try {\n    // 使用 Web Crypto API 生成 ECDSA 密钥对\n    const keyPair = await crypto.subtle.generateKey(\n      {\n        name: \"ECDSA\",\n        namedCurve: \"P-256\", // 使用 P-256 曲线\n      },\n      true, // 可导出\n      [\"sign\", \"verify\"] // 用途\n    );\n\n    // 导出公钥（格式为 spki）\n    const publicKey = await crypto.subtle.exportKey(\"spki\", keyPair.publicKey);\n\n    // 导出私钥（格式为 pkcs8）\n    const privateKey = await crypto.subtle.exportKey(\n      \"pkcs8\",\n      keyPair.privateKey\n    );\n\n    // 将密钥转换为 base64 字符串\n    const publicKeyBase64 = btoa(\n      String.fromCharCode(...new Uint8Array(publicKey))\n    );\n    const privateKeyBase64 = btoa(\n      String.fromCharCode(...new Uint8Array(privateKey))\n    );\n\n    return {\n      publicKey: publicKeyBase64,\n      privateKey: privateKeyBase64,\n    };\n  } catch (error) {\n    console.error(\"密钥对生成失败:\", error);\n    throw error;\n  }\n}\n\n/**\n * 导入私钥\n * @param {string} privateKeyBase64 - base64 编码的私钥\n * @returns {Promise<CryptoKey>} CryptoKey 对象\n */\nexport async function importPrivateKey(privateKeyBase64) {\n  try {\n    // 将 base64 转回二进制格式\n    const binaryKey = Uint8Array.from(atob(privateKeyBase64), (c) =>\n      c.charCodeAt(0)\n    );\n\n    // 导入私钥\n    const privateKey = await crypto.subtle.importKey(\n      \"pkcs8\",\n      binaryKey,\n      {\n        name: \"ECDSA\",\n        namedCurve: \"P-256\",\n      },\n      true,\n      [\"sign\"]\n    );\n\n    return privateKey;\n  } catch (error) {\n    console.error(\"私钥导入失败:\", error);\n    throw error;\n  }\n}\n\n/**\n * 导入公钥\n * @param {string} publicKeyBase64 - base64 编码的公钥\n * @returns {Promise<CryptoKey>} CryptoKey 对象\n */\nexport async function importPublicKey(publicKeyBase64) {\n  try {\n    // 将 base64 转回二进制格式\n    const binaryKey = Uint8Array.from(atob(publicKeyBase64), (c) =>\n      c.charCodeAt(0)\n    );\n\n    // 导入公钥\n    const publicKey = await crypto.subtle.importKey(\n      \"spki\",\n      binaryKey,\n      {\n        name: \"ECDSA\",\n        namedCurve: \"P-256\",\n      },\n      true,\n      [\"verify\"]\n    );\n\n    return publicKey;\n  } catch (error) {\n    console.error(\"公钥导入失败:\", error);\n    throw error;\n  }\n}\n\n/**\n * 创建签名函数\n * @param {string} privateKeyBase64 - base64 编码的私钥\n * @returns {Promise<Function>} 签名函数\n */\nexport const createSigner = async (privateKeyBase64) => {\n  try {\n    const privateKey = await importPrivateKey(privateKeyBase64);\n\n    return (message) => {\n      const encoder = new TextEncoder();\n      // 将消息转换为 Uint8Array\n      const data = encoder.encode(message);\n\n      // 使用私钥对数据进行签名\n      return crypto.subtle.sign(\n        {\n          name: \"ECDSA\",\n          hash: { name: \"SHA-256\" },\n        },\n        privateKey,\n        data\n      );\n    };\n  } catch (error) {\n    console.error(\"创建签名函数失败:\", error);\n    throw error;\n  }\n};\n\n/**\n * 创建验证函数\n * @param {string} publicKeyBase64 - base64 编码的公钥\n * @returns {Promise<Function>} 验证函数\n */\nexport const createVerifier = async (publicKeyBase64) => {\n  try {\n    const publicKey = await importPublicKey(publicKeyBase64);\n    return (message, signature) => {\n      const encoder = new TextEncoder();\n      // 将消息转换为 Uint8Array\n      const data = encoder.encode(message);\n      // 使用公钥验证签名\n      return crypto.subtle.verify(\n        {\n          name: \"ECDSA\",\n          hash: { name: \"SHA-256\" },\n        },\n        publicKey,\n        signature,\n        data\n      );\n    };\n  } catch (error) {\n    console.error(\"创建验证函数失败:\", error);\n    throw error;\n  }\n};","import { createVerifier } from \"../../crypto/crypto-ecdsa.js\";\n\nexport const verify = async (signedData) => {\n  const { signature, ...data } = signedData;\n  const msg = JSON.stringify(data);\n\n  const { publicKey } = data;\n\n  // 生成验证器\n  const verify = await createVerifier(publicKey);\n\n  try {\n    // 将 base64 转换回原始格式并验证签名\n    const signatureBuffer = new Uint8Array(\n      [...atob(signature)].map((c) => c.charCodeAt(0))\n    ).buffer;\n\n    const result = await verify(msg, signatureBuffer);\n\n    return result;\n  } catch (err) {\n    // 抛出错误信息\n    console.error(err);\n    return false;\n  }\n};\n","/**\n * 客户端管理器类\n * 负责管理所有连接到服务器的客户端，包括认证、用户状态跟踪等功能\n */\nimport { getHash } from \"../../packages/util/hash/get-hash.js\";\nimport { verify } from \"../../packages/user/util/verify.js\";\n\nexport class ClientManager {\n  constructor() {\n    this.clients = new Map(); // cid -> client，存储所有客户端连接\n    this.users = new Map(); // userId -> userData，存储认证后的用户数据\n    this.followIndex = new Map(); // followedUserId -> followerUserId[]，存储用户关注关系\n  }\n\n  /**\n   * 添加客户端到管理器\n   * @param {Client} client - 客户端实例\n   */\n  addClient(client) {\n    this.clients.set(client.cid, client);\n  }\n\n  /**\n   * 从管理器中移除客户端\n   * @param {string} cid - 客户端ID\n   */\n  removeClient(cid) {\n    const client = this.clients.get(cid);\n    if (!client) return;\n\n    this.clients.delete(cid);\n\n    if (client.userId) {\n      this._removeUserClient(client);\n    }\n  }\n\n  /**\n   * 从用户池中移除客户端\n   * @param {Client} client - 客户端实例\n   */\n  _removeUserClient(client) {\n    const userData = this.users.get(client.userId);\n    if (!userData) return;\n\n    userData.userPool.delete(client);\n\n    if (userData.userPool.size === 0) {\n      this._cleanupUser(client.userId);\n    }\n  }\n\n  /**\n   * 清理用户数据\n   * @param {string} userId - 用户ID\n   */\n  _cleanupUser(userId) {\n    const userData = this.users.get(userId);\n    if (!userData) return;\n\n    // 清理关注关系\n    const followUsers = userData.followUsers || [];\n    for (const followedUserId of followUsers) {\n      const followers = this.followIndex.get(followedUserId);\n      if (followers) {\n        const index = followers.indexOf(userId);\n        if (index > -1) {\n          followers.splice(index, 1);\n          if (followers.length === 0) {\n            this.followIndex.delete(followedUserId);\n          }\n        }\n      }\n    }\n\n    // 通知关注者用户下线\n    const followers = this.followIndex.get(userId);\n    if (followers) {\n      for (const followerId of followers) {\n        const followerUser = this.users.get(followerId);\n        if (followerUser && followerUser.userPool) {\n          followerUser.userPool.forEach((userClient) => {\n            userClient.send({\n              type: \"notify_follow\",\n              online: [],\n              offline: [userId],\n              message: \"你关注的用户下线了\",\n            });\n          });\n        }\n      }\n    }\n\n    this.users.delete(userId);\n  }\n\n  /**\n   * 验证客户端身份\n   * @param {Client} client - 客户端实例\n   * @param {Object} signedData - 签名数据\n   * @returns {Promise<string>} 用户ID\n   */\n  async authenticateClient(client, signedData) {\n    if (signedData.cid !== client.cid) {\n      throw new Error(\"cid 不匹配\");\n    }\n\n    const result = await verify(signedData);\n\n    if (!result) {\n      throw new Error(\"签名被篡改\");\n    }\n\n    const userId = await getHash(signedData.publicKey);\n\n    client.userId = userId;\n    client.publicKey = signedData.publicKey;\n    client.state = \"authed\";\n    client.userSessionId = signedData.userSessionId;\n    client.userInfo = signedData.info;\n\n    const userData = this._getOrCreateUserData(userId);\n    userData.userPool.add(client);\n    userData.userInfo = signedData.info;\n\n    // 通知关注者用户上线\n    const followers = this.followIndex.get(userId);\n    if (followers) {\n      for (const followerId of followers) {\n        const followerUser = this.users.get(followerId);\n        if (followerUser && followerUser.userPool) {\n          followerUser.userPool.forEach((userClient) => {\n            userClient.send({\n              type: \"notify_follow\",\n              online: [userId],\n              offline: [],\n              message: \"你关注的用户上线了\",\n            });\n          });\n        }\n      }\n    }\n\n    return userId;\n  }\n\n  /**\n   * 获取或创建用户数据\n   * @param {string} userId - 用户ID\n   * @returns {Object} 用户数据对象\n   */\n  _getOrCreateUserData(userId) {\n    let userData = this.users.get(userId);\n    if (!userData) {\n      userData = {\n        userId,\n        userPool: new Set(),\n        followUsers: [],\n        userInfo: null,\n      };\n      this.users.set(userId, userData);\n    }\n    return userData;\n  }\n\n  /**\n   * 更新用户关注列表\n   * @param {Client} client - 客户端实例\n   * @param {Array} followUsers - 关注的用户ID列表\n   */\n  updateFollowList(client, followUsers) {\n    if (followUsers.length > 32) {\n      followUsers = followUsers.slice(0, 32);\n    }\n\n    const userData = this.users.get(client.userId);\n    if (!userData) return;\n\n    const oldFollowUsers = userData.followUsers || [];\n\n    // 清理旧的反向索引\n    for (const followedUserId of oldFollowUsers) {\n      const followers = this.followIndex.get(followedUserId);\n      if (followers) {\n        const index = followers.indexOf(client.userId);\n        if (index > -1) {\n          followers.splice(index, 1);\n          if (followers.length === 0) {\n            this.followIndex.delete(followedUserId);\n          }\n        }\n      }\n    }\n\n    // 建立新的反向索引\n    for (const followedUserId of followUsers) {\n      if (!this.followIndex.has(followedUserId)) {\n        this.followIndex.set(followedUserId, []);\n      }\n      const followers = this.followIndex.get(followedUserId);\n      if (!followers.includes(client.userId)) {\n        followers.push(client.userId);\n      }\n    }\n\n    userData.followUsers = followUsers;\n  }\n\n  /**\n   * 根据用户ID获取用户数据\n   * @param {string} userId - 用户ID\n   * @returns {Object|undefined} 用户数据对象或undefined\n   */\n  getUserById(userId) {\n    return this.users.get(userId);\n  }\n\n  /**\n   * 根据客户端ID获取客户端实例\n   * @param {string} cid - 客户端ID\n   * @returns {Client|undefined} 客户端实例或undefined\n   */\n  getClientById(cid) {\n    return this.clients.get(cid);\n  }\n\n  /**\n   * 获取所有客户端实例数组\n   * @returns {Array} 所有客户端实例数组\n   */\n  getAllClients() {\n    return Array.from(this.clients.values());\n  }\n\n  /**\n   * 获取所有用户数据数组\n   * @returns {Array} 所有用户数据数组\n   */\n  getAllUsers() {\n    return Array.from(this.users.values());\n  }\n}\n","/**\n * 将任意可 JSON 序列化的对象 + 一个 Uint8Array 打包成一个新的 Uint8Array\n * @param {any} obj        可 JSON 序列化的对象\n * @param {Uint8Array} data 二进制数据\n * @returns {Uint8Array}   合并后的结果\n */\nexport function pack(obj, data) {\n  const meta = new TextEncoder().encode(JSON.stringify(obj));\n  const header = new Uint8Array(4);\n  new DataView(header.buffer).setUint32(0, meta.length, true); // 小端 4 字节长度\n\n  const result = new Uint8Array(4 + meta.length + data.length);\n  result.set(header, 0);\n  result.set(meta, 4);\n  result.set(data, 4 + meta.length);\n  return result;\n}\n\n/**\n * 将 pack 生成的 Uint8Array 还原成 { obj, data }\n * @param {Uint8Array} buffer 由 pack 产生的数据\n * @returns {{obj: any, data: Uint8Array}}\n */\nexport function unpack(buffer) {\n  if (buffer.length < 4) throw new Error(\"Invalid buffer\");\n  const metaLen = new DataView(buffer.buffer, buffer.byteOffset, 4).getUint32(\n    0,\n    true\n  );\n  if (4 + metaLen > buffer.length) throw new Error(\"Invalid meta length\");\n\n  const metaBytes = buffer.slice(4, 4 + metaLen);\n  const data = buffer.slice(4 + metaLen);\n\n  const obj = JSON.parse(new TextDecoder().decode(metaBytes));\n  return { obj, data };\n}\n\n// /* ========== 使用示例 ========== */\n// const originalObj = { name: \"Alice\", age: 23 };\n// const originalData = new Uint8Array([0xff, 0x00, 0xab, 0xcd]);\n\n// const packed = pack(originalObj, originalData);\n// console.log(\"packed:\", packed);\n\n// const { obj, data } = unpack(packed);\n// console.log(\"unpacked obj:\", obj);\n// console.log(\"unpacked data:\", data);\n","/**\n * 消息路由器类\n * 负责处理来自客户端的消息，根据消息类型分发到相应的处理器\n */\nimport { pack, unpack } from \"../../packages/user/util/pack.js\";\n\nexport class MessageRouter {\n  /**\n   * 构造函数，初始化消息路由器\n   * @param {ClientManager} clientManager - 客户端管理器实例\n   * @param {string} adminPassword - 管理员密码\n   */\n  constructor(clientManager, adminPassword) {\n    this.clientManager = clientManager;\n    this.adminPassword = adminPassword;\n    this.handlers = new Map();\n    this._setupDefaultHandlers();\n  }\n\n  /**\n   * 设置默认消息处理器\n   */\n  _setupDefaultHandlers() {\n    // 基础消息处理\n    this.register(\"ping\", this.handlePing);\n    this.register(\"echo\", this.handleEcho);\n    this.register(\"authentication\", this.handleAuthentication);\n    this.register(\"find_user\", this.handleFindUser);\n    this.register(\"agent_data\", this.handleAgentData);\n    this.register(\"update_delay\", this.handleUpdateDelay);\n    this.register(\"follow_list\", this.handleFollowList);\n\n    // 管理员消息处理\n    this.register(\"get_connections\", this.handleGetConnections, true);\n    this.register(\"disconnect_client\", this.handleDisconnectClient, true);\n  }\n\n  /**\n   * 注册消息处理器\n   * @param {string} messageType - 消息类型\n   * @param {Function} handler - 处理器函数\n   * @param {boolean} requireAdmin - 是否需要管理员权限，默认false\n   */\n  register(messageType, handler, requireAdmin = false) {\n    this.handlers.set(messageType, { handler, requireAdmin });\n  }\n\n  /**\n   * 处理接收到的消息\n   * @param {WebSocket} ws - WebSocket连接实例\n   * @param {Object|string|Buffer} message - 接收到的消息\n   */\n  async handleMessage(ws, message) {\n    const client = ws._client;\n    if (!client) {\n      console.error(\"客户端未初始化\");\n      return;\n    }\n\n    let binaryData = null;\n\n    // 处理二进制数据\n    if (message instanceof Buffer) {\n      try {\n        const { obj, data } = unpack(message);\n        binaryData = data;\n        message = obj;\n      } catch (error) {\n        client.send({ type: \"error\", message: \"二进制数据解析失败\" });\n        return;\n      }\n    }\n\n    const handlerInfo = this.handlers.get(message.type);\n    if (!handlerInfo) {\n      client.send({\n        type: \"error\",\n        message: \"未知的消息类型\",\n        response: message,\n      });\n      return;\n    }\n\n    // 检查管理员权限\n    if (handlerInfo.requireAdmin) {\n      if (message.password !== this.adminPassword) {\n        client.send({ type: \"error\", message: \"密码错误\" });\n        return;\n      }\n    }\n\n    try {\n      await handlerInfo.handler.call(this, {\n        client,\n        message,\n        binaryData,\n        clientManager: this.clientManager,\n      });\n    } catch (error) {\n      console.error(`处理消息 ${message.type} 时出错:`, error);\n      client.send({\n        type: \"error\",\n        message: \"消息处理失败\",\n        error: error.message,\n      });\n    }\n  }\n\n  // 基础消息处理器\n  /**\n   * 处理ping消息\n   * @param {Object} params - 参数对象\n   * @param {Client} params.client - 客户端实例\n   */\n  handlePing({ client }) {\n    client.send({\n      type: \"pong\",\n      timestamp: new Date().toISOString(),\n    });\n  }\n\n  /**\n   * 处理echo消息\n   * @param {Object} params - 参数对象\n   * @param {Client} params.client - 客户端实例\n   * @param {Object} params.message - 消息对象\n   */\n  handleEcho({ client, message }) {\n    client.send({\n      type: \"echo\",\n      message: message.message,\n      timestamp: new Date().toISOString(),\n    });\n  }\n\n  /**\n   * 处理认证消息\n   * @param {Object} params - 参数对象\n   * @param {Client} params.client - 客户端实例\n   * @param {Object} params.message - 消息对象\n   */\n  async handleAuthentication({ client, message }) {\n    try {\n      const userId = await this.clientManager.authenticateClient(\n        client,\n        message.signedData\n      );\n      client.onAuthenticated(userId);\n      client.sendAuthSuccess();\n      client.sendServerInfo();\n    } catch (error) {\n      client.send({\n        type: \"error\",\n        kind: \"authentication\",\n        message: error.message,\n      });\n\n      setTimeout(() => {\n        client.close();\n      }, 100);\n    }\n  }\n\n  /**\n   * 处理查找用户消息\n   * @param {Object} params - 参数对象\n   * @param {Client} params.client - 客户端实例\n   * @param {Object} params.message - 消息对象\n   */\n  handleFindUser({ client, message }) {\n    const { userId } = message;\n    const targetUserData = this.clientManager.getUserById(userId);\n    const userPool = targetUserData?.userPool\n      ? Array.from(targetUserData.userPool)\n      : [];\n\n    client.send({\n      type: \"response_find_user\",\n      userId,\n      publicKey: userPool.length > 0 ? userPool[0].publicKey : null,\n      tabs: userPool,\n      isOnline: userPool && userPool.length > 0,\n    });\n  }\n\n  /**\n   * 处理代理数据消息\n   * @param {Object} params - 参数对象\n   * @param {Client} params.client - 客户端实例\n   * @param {Object} params.message - 消息对象\n   * @param {Buffer} params.binaryData - 二进制数据\n   */\n  async handleAgentData({ client, message, binaryData }) {\n    const { options, data } = message;\n    const { userId, userSessionId } = options;\n\n    if (!userId) return;\n\n    const targetUserData = this.clientManager.getUserById(userId);\n    if (!targetUserData || !targetUserData.userPool) return;\n\n    let sendData;\n    try {\n      sendData = pack(\n        {\n          type: \"agent_data\",\n          fromUserId: client.userId,\n          fromUserSessionId: client.userSessionId,\n        },\n        binaryData\n      );\n    } catch (err) {\n      console.error(\"打包数据失败:\", err);\n      return;\n    }\n\n    let targetDeviceClient = null;\n\n    if (userSessionId) {\n      targetDeviceClient = Array.from(targetUserData.userPool).find(\n        (c) => c.userSessionId === userSessionId\n      );\n    }\n\n    if (!targetDeviceClient) {\n      targetDeviceClient = targetUserData.userPool.values().next().value;\n    }\n\n    if (targetDeviceClient) {\n      targetDeviceClient.send(sendData);\n    }\n  }\n\n  /**\n   * 处理更新延迟消息\n   * @param {Object} params - 参数对象\n   * @param {Client} params.client - 客户端实例\n   * @param {Object} params.message - 消息对象\n   */\n  handleUpdateDelay({ client, message }) {\n    const { delay } = message;\n    client.delay = delay;\n  }\n\n  /**\n   * 处理关注列表消息\n   * @param {Object} params - 参数对象\n   * @param {Client} params.client - 客户端实例\n   * @param {Object} params.message - 消息对象\n   */\n  handleFollowList({ client, message }) {\n    const newFollowUsers = message.follows.split(\",\");\n    this.clientManager.updateFollowList(client, newFollowUsers);\n  }\n\n  // 管理员消息处理器\n  /**\n   * 处理获取连接信息消息（管理员）\n   * @param {Object} params - 参数对象\n   * @param {Client} params.client - 客户端实例\n   */\n  handleGetConnections({ client }) {\n    const connectionsInfo = this.clientManager\n      .getAllClients()\n      .map((client2) => ({\n        id: client2.cid,\n        userId: client2.userId,\n        userInfo: client2.userInfo,\n        connectTime: client2.connectTime,\n        state: client2.state,\n        username: client2.userInfo?.name,\n        delay: client2.delay,\n      }));\n\n    client.send({\n      type: \"connections_info\",\n      clients: connectionsInfo,\n    });\n  }\n\n  /**\n   * 处理断开客户端连接消息（管理员）\n   * @param {Object} params - 参数对象\n   * @param {Client} params.client - 客户端实例\n   * @param {Object} params.message - 消息对象\n   */\n  handleDisconnectClient({ client, message }) {\n    const { clientId } = message;\n    if (!clientId) {\n      client.send({ type: \"error\", message: \"缺少客户端ID参数\" });\n      return;\n    }\n\n    const targetClient = this.clientManager.getClientById(clientId);\n    if (targetClient) {\n      targetClient.close();\n      client.send({\n        type: \"success\",\n        message: `已断开客户端 ${clientId} 的连接`,\n      });\n    } else {\n      client.send({\n        type: \"error\",\n        message: `未找到客户端 ${clientId}`,\n      });\n    }\n  }\n}\n","/**\n * 客户端类\n * 表示一个连接到服务器的客户端连接，处理客户端的状态和通信\n */\nexport class Client {\n  /**\n   * 构造函数，初始化客户端\n   * @param {WebSocket} ws - WebSocket连接实例\n   * @param {WebSocketServer} server - WebSocket服务器实例\n   * @param {ClientManager} clientManager - 客户端管理器实例\n   */\n  constructor(ws, server, clientManager) {\n    if (ws._client) {\n      throw new Error(\"客户端已经初始化过:\" + ws._client.cid);\n    }\n\n    this.ws = ws;\n    this.server = server;\n    this.clientManager = clientManager;\n\n    this.cid = this._generateCid();\n    this.state = \"unauth\"; // 未认证：unauth；认证完成：authed\n    this.userId = null;\n    this.publicKey = null;\n    this.userSessionId = null;\n    this.delay = 0;\n    this.connectTime = new Date();\n    this.userInfo = null;\n\n    this._authTimer = null;\n    this._setupAuthTimeout();\n\n    ws._client = this;\n  }\n\n  /**\n   * 生成客户端唯一ID\n   * @returns {string} 客户端ID\n   */\n  _generateCid() {\n    let cid = Math.random().toString(36).slice(2, 8);\n    while (this.server.clients && this.server.clients.has(cid)) {\n      cid = Math.random().toString(36).slice(2, 8);\n    }\n    return cid;\n  }\n\n  /**\n   * 设置认证超时\n   */\n  _setupAuthTimeout() {\n    this._authTimer = setTimeout(() => {\n      if (this.state === \"unauth\") {\n        this.close();\n      }\n    }, 5000); // 5秒未认证则关闭连接\n  }\n\n  /**\n   * 发送数据到客户端\n   * @param {Object|Buffer} data - 要发送的数据\n   */\n  send(data) {\n    try {\n      if (this._isBinaryData(data)) {\n        this.ws.send(data);\n      } else {\n        this.ws.send(JSON.stringify(data));\n      }\n    } catch (error) {\n      console.error(\"发送数据失败:\", error);\n    }\n  }\n\n  /**\n   * 判断是否为二进制数据\n   * @param {*} data - 待判断的数据\n   * @returns {boolean} 是否为二进制数据\n   */\n  _isBinaryData(data) {\n    return (\n      data instanceof ArrayBuffer ||\n      data instanceof Uint8Array ||\n      data instanceof Buffer ||\n      typeof data === \"string\"\n    );\n  }\n\n  /**\n   * 关闭客户端连接\n   */\n  close() {\n    if (this._authTimer) {\n      clearTimeout(this._authTimer);\n      this._authTimer = null;\n    }\n    this.ws.close();\n  }\n\n  /**\n   * 客户端认证成功后的处理\n   * @param {string} userId - 用户ID\n   */\n  onAuthenticated(userId) {\n    this.state = \"authed\";\n    if (this._authTimer) {\n      clearTimeout(this._authTimer);\n      this._authTimer = null;\n    }\n  }\n\n  /**\n   * 发送服务器信息到客户端\n   */\n  sendServerInfo() {\n    this.send({\n      type: \"server_info\",\n      serverName: this.server.serverName,\n      serverVersion: this.server.serverVersion,\n      cid: this.cid,\n    });\n  }\n\n  /**\n   * 发送认证成功消息到客户端\n   */\n  sendAuthSuccess() {\n    this.send({\n      type: \"auth_success\",\n      userInfo: this.userInfo,\n      userId: this.userId,\n      message: \"认证成功\",\n    });\n  }\n\n  /**\n   * 发送需要认证消息到客户端\n   */\n  sendNeedAuth() {\n    this.send({\n      type: \"need_auth\",\n      cid: this.cid,\n      time: new Date().toISOString(),\n    });\n  }\n\n  /**\n   * 将客户端信息转换为JSON对象\n   * @returns {Object} 客户端信息对象\n   */\n  toJSON() {\n    return {\n      cid: this.cid,\n      userId: this.userId,\n      userInfo: this.userInfo,\n      userSessionId: this.userSessionId,\n      connectTime: this.connectTime.toISOString(),\n      state: this.state,\n      delay: this.delay,\n    };\n  }\n}\n","#!/usr/bin/env node\n\nimport { WebSocketServer } from \"./websocket-server.js\";\nimport { ClientManager } from \"./client-manager.js\";\nimport { MessageRouter } from \"./message-router.js\";\nimport { Client } from \"./client.js\";\nimport { createRequire } from \"node:module\";\n\nconst require = createRequire(import.meta.url);\nconst packageJson = require(\"../package.json\");\n\n/**\n * 初始化服务器\n * @param {Object} options - 服务器配置选项\n * @param {string} options.password - 管理员密码\n * @param {number} options.port - 服务器端口，默认8081\n * @param {string} options.serverName - 服务器名称，默认\"handserver\"\n * @returns {WebSocketServer} WebSocket服务器实例\n */\nexport const initServer = async ({\n  password,\n  port = 8081,\n  serverName = \"handserver\",\n}) => {\n  // 初始化管理器\n  const clientManager = new ClientManager();\n  const messageRouter = new MessageRouter(clientManager, password);\n\n  // WebSocket事件处理函数\n  /**\n   * 处理新客户端连接\n   * @param {WebSocket} ws - WebSocket连接实例\n   */\n  function onConnect(ws) {\n    const client = new Client(ws, server, clientManager);\n\n    clientManager.addClient(client);\n    console.log(\"新客户端已连接:\", client.cid);\n\n    // 发送认证请求\n    client.sendNeedAuth();\n  }\n\n  /**\n   * 处理客户端断开连接\n   * @param {WebSocket} ws - WebSocket连接实例\n   * @param {number} code - 断开代码\n   * @param {string} reason - 断开原因\n   */\n  function onClose(ws, code, reason) {\n    const client = ws._client;\n    if (client) {\n      console.log(\"客户端断开连接:\", client.cid);\n      clientManager.removeClient(client.cid);\n    }\n  }\n\n  /**\n   * 处理WebSocket错误\n   * @param {WebSocket} ws - WebSocket连接实例\n   * @param {Error} error - 错误对象\n   */\n  function onError(ws, error) {\n    console.error(\"WebSocket错误:\", error);\n    const client = ws._client;\n    if (client) {\n      onClose(ws);\n    }\n  }\n\n  /**\n   * 处理接收到的消息\n   * @param {WebSocket} ws - WebSocket连接实例\n   * @param {Object|string} message - 接收到的消息\n   */\n  async function onMessage(ws, message) {\n    await messageRouter.handleMessage(ws, message);\n  }\n\n  // 创建WebSocket服务器\n  const server = new WebSocketServer({\n    onMessage,\n    onConnect,\n    onClose,\n    onError,\n  });\n\n  // 添加服务器属性\n  server.serverName = serverName;\n  server.serverVersion = packageJson.version;\n\n  // 启动服务器\n  server.start(port);\n\n  console.log(`NoneOS WebSocket服务器启动`);\n  console.log(`服务器名称: ${serverName}`);\n  console.log(`版本: ${packageJson.version}`);\n  console.log(`监听端口: ${port}`);\n\n  return server;\n};\n\n// // 如果是直接运行此文件，则启动服务器\n// if (import.meta.url === `file://${process.argv[1]}`) {\n//   const password = process.env.SERVER_PASSWORD || \"noneos-server-password\";\n//   const port = parseInt(process.env.PORT || \"8081\");\n//   const serverName = process.env.SERVER_NAME || \"handserver\";\n\n//   initServer({ password, port, serverName }).catch((error) => {\n//     console.error(\"启动服务器失败:\", error);\n//     process.exit(1);\n//   });\n// }\n"],"names":[],"mappings":"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"}