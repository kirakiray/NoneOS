<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="/packages/libs/ofa/ofa.js" type="module"></script>

    <style>
      body {
        margin: 0;
        padding: 0;
        color: #fff;
        background-color: black;
      }

      iframe {
        display: block;
        width: 80%;
        height: 400px;
        border: 1px solid white;
      }
    </style>
  </head>
  <body>
    <iframe src="./receive-case.html?tab1" frameborder="0"></iframe>
    <iframe src="./receive-case.html?tab2" frameborder="0"></iframe>
    <iframe src="./receive-case.html?tab3" frameborder="0"></iframe>
    <script type="module">
      import { createUser } from "/packages/new-user/main.js";

      const iframes = $.all("iframe");

      iframes[0].on("load", async () => {
        const user1 = await createUser({ user: "test-user1" });
        await user1.connectAllServers();

        // 在等待一下
        await new Promise((resolve) => setTimeout(resolve, 300));

        // 从第一个iframe中获取user2
        const user2_1 = iframes[0].ele.contentWindow.user2;
        const user2_2 = iframes[1].ele.contentWindow.user2;
        const user2_3 = iframes[2].ele.contentWindow.user2;

        const remoteUser2 = await user1.connectUser(user2_1.userId);

        // 发送数据
        remoteUser2.post(
          {
            type: "test",
            val: "hello2",
          },
          {
            userSessionId: user2_2.sessionId,
          }
        );

        await new Promise((resolve) => setTimeout(resolve, 300));

        console.log(
          iframes[1].ele.contentWindow.$("#receive-data").text === "hello2"
        ); // true
      });
    </script>
  </body>
</html>
