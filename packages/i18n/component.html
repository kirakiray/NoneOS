<template component>
  <style>
    :host {
      display: contents;
    }
  </style>
  <div></div>
  <script>
    export default async ({ load }) => {
      const { data, spaceAddress } = await load("./data.js");

      return {
        tag: "n-desc",
        attrs: {
          name: "", // 描述名称
          space: "",
        },
        data: {},
        proto: {
          changeName() {
            const val = data.space[this.space][this.name];

            if (this.__oldVal === val) {
              return;
            }
            this.__oldVal = val;

            this.text = val;
            this.emit("change-desc-text");
          },
        },
        watch: {
          name() {
            this.changeName();
          },
          space() {
            this.changeName();
          },
        },
        attached() {
          this._wid = data.watchTick(() => {
            this.changeName();
          });
        },
        detached() {
          if (this._wid) {
            data.unwatchTick(this._wid);
          }
        },
      };
    };
  </script>
</template>
