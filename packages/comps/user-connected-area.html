<template component>
  <style>
    :host {
      display: block;
    }
  </style>
  <l-m src="/packages/pui/button/button.html"></l-m>
  <p-button size="mini" on:click="linkUser">连接</p-button>
  <script>
    export default async ({ load }) => {
      const { getConnectionStore, connect } = await load(
        "/packages/user/connection/main.js"
      );

      const connections = await getConnectionStore();

      return {
        tag: "user-connected-area",
        attrs: {
          // 用户id
          userId: null,
        },
        data: {
          user: {}, // 当前用户
          connections: [], // 所有用户连接
        },
        proto: {
          async linkUser() {
            const user = connect({
              userId: this.userId,
            });

            debugger;
          },
        },
        attached() {
          this.connections = connections;

          // 监听用户是否出现
          // this._wid = connections.watchTick(() => {});
        },
        detached() {
          this.connections = [];
          this.user = {};
          // this._wid && connections.unwatch(this._wid);
        },
      };
    };
  </script>
</template>
