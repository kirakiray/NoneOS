<template component>
  <style>
    :host {
      display: block;
    }
  </style>
  <l-m src="/packages/pui/button/button.html"></l-m>
  <x-if :value="connection.state === 'not-ready'">
    <p-button size="mini" on:click="linkUser">连接</p-button>
  </x-if>
  {{connection.state}}
  <script>
    export default async ({ load }) => {
      const { getConnection } = await load("/packages/user/connection/main.js");

      return {
        tag: "user-connected-area",
        attrs: {
          // 用户id
          userId: null,
        },
        data: {
          connection: {}, // 当前用户
        },
        proto: {
          async linkUser() {
            this.connection.connect();
          },
        },
        attached() {
          this.connection = getConnection({ userId: this.userId });
        },
        detached() {
          this.connection = {};
        },
      };
    };
  </script>
</template>
