<template page>
  <l-m src="/packages/pui/table/table.html"></l-m>
  <l-m src="/packages/local-icon/local-icon.html"></l-m>
  <l-m src="../comps/copy-span.html"></l-m>
  <style>
    :host {
      display: block;
    }
  </style>
  <p-table style="margin-right: 16px">
    <p-table-row>
      <p-table-cell basis="120">用户名</p-table-cell>
      <p-table-cell>
        <x-if :value="renameMode">
          <input
            id="renameInputer"
            type="text"
            sync:value="userName"
            on:change="renameEnd"
            on:blur="renameMode = false"
          />
        </x-if>
        <x-else>
          <div>{{userName}}</div>
        </x-else>

        <p-button
          icon
          size="small"
          variant="text"
          on:click="renameMode = true"
          class:hide="renameMode"
          style="margin-left: 8px"
        >
          <n-local-icon name="edit"></n-local-icon>
        </p-button>
      </p-table-cell>
    </p-table-row>
    <p-table-row>
      <p-table-cell>用户ID</p-table-cell>
      <p-table-cell>
        <n-copy-span style="max-width: 300px">{{userID}} </n-copy-span>
      </p-table-cell>
    </p-table-row>
    <p-table-row>
      <p-table-cell>签名公钥</p-table-cell>
      <p-table-cell>
        <div class="row-val" attr:title="signPublic">
          <n-copy-span style="max-width: 300px">{{signPublic}} </n-copy-span>
        </div>
      </p-table-cell>
    </p-table-row>
  </p-table>
  <script>
    export const parent = "../outer.html";

    export default async ({ load }) => {
      const { getId, getPublic } = await load("/packages/util/pair.js");
      const { getInfo, setInfo } = await load("/packages/util/user.js");

      const selfUserInfo = await getInfo();

      return {
        data: {
          userName: selfUserInfo.userName,
          userID: await getId(),
          signPublic: await getPublic(),
          renameMode: false,
        },
        watch: {
          renameMode(bool) {
            if (bool) {
              setTimeout(() => {
                this.shadow.$("#renameInputer") &&
                  this.shadow.$("#renameInputer").ele.focus();
              }, 100);
            }
          },
        },
        proto: {
          renameEnd(e) {
            this.renameMode = false;

            setInfo({
              userName: this.userName,
            });
          },
        },
        attached() {
          this.emit("update-title", {
            composed: true,
            data: {
              titles: [
                {
                  name: "首页",
                },
              ],
            },
          });
        },
      };
    };
  </script>
</template>
