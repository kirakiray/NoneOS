<template page>
  <l-m src="../comps/moment-span.html"></l-m>
  <l-m src="../comps/data-block.html"></l-m>
  <l-m src="../comps/block-log.html"></l-m>
  <style>
    :host {
      display: block;
    }

    h4 {
      margin: 16px 0 0;
      padding: 4px 0;
      font-size: 14px;
    }

    .list {
      display: flex;
      flex-wrap: wrap;
    }

    .empty-content {
      width: 200px;
      text-align: center;
      line-height: 60px;
      font-size: 12px;
      color: #7e7e7e;
    }
  </style>

  <h4>块日志</h4>
  <div class="list">
    <x-fill :value="blocks" fill-key="gid">
      <n-block-log
        :hashs="$data.hashs"
        :type="$data.type"
        :time="$data.time"
      ></n-block-log>
    </x-fill>
    <x-if :value="!blocks.length">
      <div class="empty-content">空</div>
    </x-if>
  </div>

  <script>
    export const parent = "../outer.html";

    export default async ({ load }) => {
      const { on, blocks } = await load("/packages/core/main.js");

      return {
        data: {
          blocks: [], // 块日志
        },
        proto: {
          getState(state) {
            switch (state) {
              case "waiting":
                return "等待发送";
              case "sended":
                return "已发送";
              case "send-ok":
                return "发送成功";
            }
          },
        },
        attached() {
          this.blocks = blocks;
          this.emit("update-title", {
            composed: true,
            data: {
              titles: [
                {
                  name: "数据块",
                },
              ],
            },
          });
        },
        detached() {
          this.blocks = [];
        },
      };
    };
  </script>
</template>
