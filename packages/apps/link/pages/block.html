<template page>
  <l-m src="../comps/moment-span.html"></l-m>
  <l-m src="../comps/data-block.html"></l-m>
  <style>
    :host {
      display: block;
    }
    h4 {
      margin: 16px 0 0;
      padding: 4px 0;
      font-size: 14px;
    }

    .list {
      display: flex;
      flex-wrap: wrap;
    }

    .empty-content {
      width: 200px;
      text-align: center;
      line-height: 60px;
      font-size: 12px;
      color: #7e7e7e;
    }
  </style>
  <h4>请求日志</h4>
  <div class="list">
    <div class="empty-content">空</div>
  </div>

  <h4>获得日志</h4>
  <div class="list">
    <div class="empty-content">空</div>
  </div>

  <h4>发送日志</h4>
  <div class="list">
    <x-fill :value="receiveds" fill-key="gid">
      <n-data-block
        :hashs="$data.hashs"
        :user-name="$data.userName"
        :user-id="$data.userId"
        :gid="$data.gid"
      ></n-data-block>
    </x-fill>
    <x-if :value="!receiveds.length">
      <div class="empty-content">空</div>
    </x-if>
  </div>

  <script>
    export const parent = "../outer.html";

    export default async ({ load }) => {
      const { on } = await load("/packages/core/main.js");

      return {
        data: {
          receiveds: [], // 接收到的请求
        },
        proto: {
          getState(state) {
            switch (state) {
              case "waiting":
                return "等待发送";
              case "sended":
                return "已发送";
              case "send-ok":
                return "发送成功";
            }
          },
        },
        attached() {
          this._cancels = [
            on("received-get-block", ({ data }) => {
              const { hashs, userName, userId, gid } = data;

              this.receiveds.push({
                gid,
                userName,
                userId,
                hashs,
              });
            }),
          ];
          this.emit("update-title", {
            composed: true,
            data: {
              titles: [
                {
                  name: "数据块",
                },
              ],
            },
          });
        },
        detached() {
          this._cancels.forEach((f) => f());
        },
      };
    };
  </script>
</template>
