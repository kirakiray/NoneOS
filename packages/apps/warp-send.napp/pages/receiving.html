<template page>
  <style>
    :host {
      display: block;
    }
  </style>
  接受中...
  <script>
    export default async ({ load, query }) => {
      const { createUser } = await load("/packages/user/main.js");
      const { startReceiveTask } = await load("../util/task-manager.js");

      const localUser = await createUser({
        user: query.localname,
      });

      await localUser.connectAllServers();

      return {
        data: {
          files: [],
        },
        async attached() {
          const { unsubscribe } = await startReceiveTask({
            localUser,
            userId: query.userId,
            taskHash: query.taskHash,
          });

          this._unsubscribe = unsubscribe;
          if (!this.ele.isConnected) {
            unsubscribe();
          }
        },
        detached() {
          this._unsubscribe && this._unsubscribe();
        },
      };
    };
  </script>
</template>
