<template page>
  <style>
    :host {
      display: block;
    }
  </style>
  接受中...
  <script>
    export default async ({ load, query }) => {
      const { createUser } = await load("/packages/user/main.js");
      const localUser = await createUser({
        user: query.localname,
      });

      await localUser.connectAllServers();

      return {
        data: {
          files: [],
        },
        async attached() {
          const remoteUser = await localUser.connectUser(query.userId);

          this._cancel = remoteUser.bind("receive-data", (data) => {
            console.log("receive-data", data);
          });

          const defaultDir = await this.app.dedicatedHandle();

          const taskDir = await defaultDir.get(query.taskHash, {
            create: "dir",
          });

          let mainData = await taskDir.get("main.json");
          mainData = await mainData.json();

          debugger;
        },
        detached() {
          // this._cancel && this._cancel();
        },
      };
    };
  </script>
</template>
