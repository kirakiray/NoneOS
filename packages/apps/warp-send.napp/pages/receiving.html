<template page>
  <style>
    :host {
      display: block;
    }
  </style>
  接受中...
  <script>
    export default async ({ load, query }) => {
      const { createUser } = await load("/packages/user/main.js");
      const { initReceiveTask } = await load("../util/create-task.js");

      const localUser = await createUser({
        user: query.localname,
      });

      await localUser.connectAllServers();

      return {
        data: {
          files: [],
        },
        async attached() {
          const { cancel } = await initReceiveTask({
            localUser,
            userId: query.userId,
            taskHash: query.taskHash,
          });

          this._cancel = cancel;
          if (!this.ele.isConnected) {
            cancel();
          }
        },
        detached() {
          this._cancel && this._cancel();
        },
      };
    };
  </script>
</template>
