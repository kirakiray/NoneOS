<template page>
  <l-m src="../comps/bookmark-card.html"></l-m>
  <l-m src="../comps/bm-add-card.html"></l-m>
  <style>
    :host {
      position: relative;
      display: flex !important;
      flex-direction: column;
      width: 100%;
      height: 100%;
      background: url(/packages/others/default-bg.jpg) no-repeat;
      background-size: cover;
      background-position: center;
    }

    .tool-container {
      display: flex;
      padding: 16px;
      height: 100px;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }

    .main {
      position: relative;
      flex: 1;
    }

    .main-inner {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      max-height: 100%;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start;
      overflow: auto;
    }
  </style>

  <div class="tool-container"></div>

  <div class="main">
    <div class="main-inner">
      <o-fill :value="currentCards">
        <n-bookmark-card
          :url="$data.url"
          :logo-url="$data.logoUrl"
        ></n-bookmark-card>
      </o-fill>
      <o-if :value="!currentCards.length">
        <div>没有数据</div>
      </o-if>
      <bm-add-card on:add-web="addWeb"></bm-add-card>
    </div>
  </div>

  <script>
    export default async ({ load }) => {
      const { createData } = await load("/packages/hybird-data/main.js");

      return {
        data: {
          list: [], // 所有的用户数据
          // currentCards: [], // 当前显示的数据
          currentCards: [
            {
              url: "htts://baidu.com",
              logoUrl: "https://cdn.worldvectorlogo.com/logos/baidu.svg",
            },
            {
              url: "https://myzaker.com",
              logoUrl:
                "https://zkres.myzaker.com/webres/pWeb/zaker/www/dist/css/img/logo_festival@2x.png",
            },
            {
              url: "https://google.com",
              logoUrl: "https://cdn.worldvectorlogo.com/logos/google.svg",
            },
            {
              url: "https://google.com",
              logoUrl: "https://cdn.worldvectorlogo.com/logos/google.svg",
            },
            {
              url: "https://google.com",
              logoUrl: "https://cdn.worldvectorlogo.com/logos/google.svg",
            },
          ],
        },
        proto: {
          async addWeb({ data }) {
            const { url } = data;

            this.currentCards.push({
              url,
            });
          },
        },
        async attached() {
          // 获取专属文件句柄
          const handle = await this.app.dedicatedHandle();

          const dataHandle = await handle.get("data", {
            create: "dir",
          });

          const mainData = await createData(dataHandle);

          if (!mainData.cards) {
            // 初始化本地数据
            mainData.cards = [];
          }
        },
        detached() {
          this.currentCards = [];
        },
      };
    };
  </script>
</template>
