<template page>
  <link rel="stylesheet" href="../common/common.css" />
  <style>
    :host {
      display: block;
    }
    h4 {
      font-size: 16px;
      margin: 24px 0 8px;
      color: var(--md-sys-color-primary);
    }

    h4:first-of-type {
      margin-top: 0;
    }

    .inputer-line {
      margin-top: 8px;
      display: flex;
      align-items: center;
    }

    .inputer-line p-input {
      width: 56px;
      margin-left: 16px;
    }

    .inputer-line p-slider {
      margin-left: 16px;
    }

    .bg-opts {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .bg-opts p-select,
    .bg-opts p-input {
      display: inline-block;
      min-width: 160px;
      margin: 12px 12px 0 0;
    }
    .bg-opts p-input {
      min-width: 160px;
    }
  </style>
  <div>
    <h4 class="hide-in-mobile">
      <localized-content>
        <span lang="cn">尺寸设置</span>
        <span lang="en">Size Settings</span>
        <span lang="ja">サイズ設定</span>
      </localized-content>
    </h4>
    <div class="inputer-line hide-in-mobile">
      <localized-content>
        <span lang="cn">块宽度</span>
        <span lang="en">Block Width</span>
        <span lang="ja">ブロック幅</span>
      </localized-content>
      <p-slider no-bubble sync:value="setting.width" min="100" max="300">
      </p-slider>
      <p-input readonly sync:value="setting.width" size="small"></p-input>
    </div>
    <div class="inputer-line hide-in-mobile">
      <localized-content>
        <span lang="cn">块高度</span>
        <span lang="en">Block Height</span>
        <span lang="ja">ブロック高さ</span>
      </localized-content>
      <p-slider no-bubble sync:value="setting.height" min="50" max="150">
      </p-slider>
      <p-input readonly sync:value="setting.height" size="small"></p-input>
    </div>
    <div class="inputer-line hide-in-mobile">
      <localized-content>
        <span lang="cn">块间距</span>
        <span lang="en">Block Spacing</span>
        <span lang="ja">ブロック間隔</span>
      </localized-content>
      <p-slider no-bubble sync:value="setting.space" min="2" max="40">
      </p-slider>
      <p-input readonly sync:value="setting.space" size="small"></p-input>
    </div>
    <div class="inputer-line hide-in-mobile">
      <localized-content>
        <span lang="cn">容器宽度</span>
        <span lang="en">Container Width</span>
        <span lang="ja">コンテナ幅</span>
      </localized-content>
      <p-slider
        no-bubble
        sync:value="setting.containerMaxWidth"
        min="800"
        max="2400"
      >
      </p-slider>
      <p-input
        readonly
        sync:value="setting.containerMaxWidth"
        size="small"
      ></p-input>
    </div>
    <p-button
      size="small"
      on:click="resetSize"
      class="hide-in-mobile"
      style="margin-top: 8px"
    >
      <localized-content>
        <span lang="cn">恢复默认尺寸</span>
        <span lang="en">Restore Default Size</span>
        <span lang="ja">デフォルトサイズに戻す</span>
      </localized-content>
    </p-button>
    <h4>
      <localized-content>
        <span lang="cn">背景设置</span>
        <span lang="en">Background Settings</span>
        <span lang="ja">背景設定</span>
      </localized-content>
    </h4>
    <div style="display: flex; align-items: flex-end">
      <div
        style="
          width: 100px;
          height: 60px;
          border: var(--md-sys-color-primary) solid 1px;
          background-size: contain;
          background-repeat: no-repeat;
          background-position: center center;
        "
        :style.background-image="`url(${setting.bgurl || ''})`"
        :style.background-color="setting.bgcolor"
      ></div>
      <div>
        <o-if :value="setting.bgurl !== defaultBgurl">
          <div>
            <p-button
              size="small"
              on:click="setting.bgurl = defaultBgurl"
              style="margin-left: 8px"
            >
              <localized-content>
                <span lang="cn">恢复默认背景</span>
                <span lang="en">Restore Default Background</span>
                <span lang="ja">デフォルト背景に戻す</span>
              </localized-content>
            </p-button>
          </div>
        </o-if>

        <div>
          <input
            type="file"
            accept="image/*"
            style="display: none"
            id="bgimgInputer"
            on:change="changeBgImg"
          />
          <p-button
            size="small"
            on:click="shadow.$('#bgimgInputer').ele.click()"
            style="margin-left: 8px; margin-top: 4px"
          >
            <localized-content>
              <span lang="cn">更改背景</span>
              <span lang="en">Change Background</span>
              <span lang="ja">背景を変更</span>
            </localized-content>
          </p-button>
        </div>
      </div>
    </div>
    <div class="bg-opts">
      <p-select size="small" sync:value="setting.bgposition">
        <label
          ><localized-content>
            <span lang="cn">背景对齐</span>
            <span lang="en">Background Align</span>
            <span lang="ja">背景配置</span>
          </localized-content></label
        >
        <p-option value="center top"
          ><localized-content>
            <span lang="cn">顶部居中</span>
            <span lang="en">Top Center</span>
            <span lang="ja">上中央</span>
          </localized-content></p-option
        >
        <p-option value="center center"
          ><localized-content>
            <span lang="cn">居中</span>
            <span lang="en">Center</span>
            <span lang="ja">中央</span>
          </localized-content></p-option
        >
        <p-option value="center bottom"
          ><localized-content>
            <span lang="cn">底部居中</span>
            <span lang="en">Bottom Center</span>
            <span lang="ja">下中央</span>
          </localized-content></p-option
        >
        <p-option value="left top"
          ><localized-content>
            <span lang="cn">左上角</span>
            <span lang="en">Top Left</span>
            <span lang="ja">左上</span>
          </localized-content></p-option
        >
        <p-option value="left center"
          ><localized-content>
            <span lang="cn">左侧居中</span>
            <span lang="en">Left Center</span>
            <span lang="ja">左中央</span>
          </localized-content></p-option
        >
        <p-option value="left bottom"
          ><localized-content>
            <span lang="cn">左下角</span>
            <span lang="en">Bottom Left</span>
            <span lang="ja">左下</span>
          </localized-content></p-option
        >
        <p-option value="right top"
          ><localized-content>
            <span lang="cn">右上角</span>
            <span lang="en">Top Right</span>
            <span lang="ja">右上</span>
          </localized-content></p-option
        >
        <p-option value="right center"
          ><localized-content>
            <span lang="cn">右侧居中</span>
            <span lang="en">Right Center</span>
            <span lang="ja">右中央</span>
          </localized-content></p-option
        >
        <p-option value="right bottom"
          ><localized-content>
            <span lang="cn">右下角</span>
            <span lang="en">Bottom Right</span>
            <span lang="ja">右下</span>
          </localized-content></p-option
        >
      </p-select>
      <p-select size="small" sync:value="setting.bgsize">
        <label
          ><localized-content>
            <span lang="cn">背景显示模式</span>
            <span lang="en">Background Display Mode</span>
            <span lang="ja">背景表示モード</span>
          </localized-content></label
        >
        <p-option value="cover"
          ><localized-content>
            <span lang="cn">填充模式</span>
            <span lang="en">Fill Mode</span>
            <span lang="ja">フィルモード</span>
          </localized-content></p-option
        >
        <p-option value="contain"
          ><localized-content>
            <span lang="cn">适应模式</span>
            <span lang="en">Fit Mode</span>
            <span lang="ja">フィットモード</span>
          </localized-content></p-option
        >
        <p-option value="auto"
          ><localized-content>
            <span lang="cn">原始尺寸</span>
            <span lang="en">Original Size</span>
            <span lang="ja">元のサイズ</span>
          </localized-content></p-option
        >
      </p-select>
      <o-if :value="setting.bgsize !== 'cover'">
        <label>
          <localized-content>
            <span lang="cn">背景平铺</span>
            <span lang="en">Background Tile</span>
            <span lang="ja">背景タイル</span>
          </localized-content>
        </label>
        <p-switch sync:value="setting.bgrepeat">
          <p-option :value="false">
            <localized-content>
              <span lang="cn">不平铺</span>
              <span lang="en">No Tile</span>
              <span lang="ja">タイルなし</span>
            </localized-content>
          </p-option>
          <p-option :value="true">
            <localized-content>
              <span lang="cn">平铺</span>
              <span lang="en">Tile</span>
              <span lang="ja">タイル</span>
            </localized-content>
          </p-option>
        </p-switch>
      </o-if>
    </div>

    <div
      class="bg-opts"
      style="display: flex; align-items: flex-start; margin-top: 16px"
    >
      <span style="display: inline-block; padding-top: 8px">
        <localized-content>
          <span lang="cn">背景颜色</span>
          <span lang="en">Background Color</span>
          <span lang="ja">背景色</span>
        </localized-content>
      </span>
      <p-color-picker
        sync:value="setting.bgcolor"
        style="margin-left: 8px"
      ></p-color-picker>
    </div>
    <!--
        <div>感谢，图片来自unsplsh的具体地址</div> -->
  </div>
  <script>
    export default {
      data: {
        setting: {
          width: 200,
          height: 80,
          space: 16,
          containerMaxWidth: 1200,
          bgurl: "", // 背景图片地址
          bgsize: "",
          bgrepeat: "",
          bgposition: "",
          bgcolor: "", // 背景色
          sort: "custom", // 排序方式
        },
      },
      proto: {
        async changeBgImg(e) {
          const file = e.target?.files[0];

          if (!file) {
            return;
          }

          // 写入到应用文件夹下
          const appDataHandle = await this.app.dedicatedHandle();

          const bgDir = await appDataHandle.get("bgimg", {
            create: "dir",
          });

          // 删除已存在的背景图
          if ((await bgDir.length()) > 0) {
            for await (let e of bgDir.values()) {
              await e.remove();
            }
          }

          const fileHandle = await bgDir.get(`${file.name}`, {
            create: "file",
          });

          await fileHandle.write(file);

          this.setting.bgurl = `/$${fileHandle.path}`;
        },
        get defaultBgurl() {
          return "/packages/apps/bookmarks.napp/sources/bg/erone-stuff-unsplash.svg";
        },
        resetSize() {
          // 修正尺寸参数
          Object.assign(this.setting, {
            width: 200,
            height: 80,
            space: 16,
            containerMaxWidth: 1200,
          });
        },
      },
      attached() {
        setTimeout(() => {
          const mainData = this.app._mainData;

          mainData && (this.setting = mainData.setting);
        }, 1000);
      },
      detached() {
        this.setting = {};
      },
    };
  </script>
</template>
