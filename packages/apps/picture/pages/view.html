<template page>
  <style>
    :host {
      display: block;
      background-color: var(--md-sys-color-surface);
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .top-tool,
    .bottom-tool {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 30px;
      background-color: var(--md-sys-color-on-normal);
    }

    .top-tool {
      text-align: center;
      background-color: var(--md-sys-color-surface);
    }

    .title {
      text-align: center;
      user-select: text;
      padding: 0 12px;
    }

    .main {
      flex: 1;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
  <div class="container">
    <div class="top-tool">
      <div class="title">{{imgName}}</div>
    </div>
    <div class="main">
      <img attr:src="imgsrc" />
    </div>
    <div class="bottom-tool">v</div>
  </div>
  <script>
    export default async ({ load, query }) => {
      const { path } = query;

      const { get } = await load("/packages/fs/main.js");

      return {
        data: {
          path,
          imgsrc: "",
          imgName: "",
        },
        proto: {
          async loadImg() {
            const handle = await get(path).catch(() => null);

            if (handle) {
              this.imgName = handle.name;

              const file = await handle.file();

              const newUrl = URL.createObjectURL(file);

              if (this.imgsrc) {
                URL.revokeObjectURL(this.imgsrc);
              }

              this.imgsrc = newUrl;
              return;
            }

            // TODO: 没有找到对应的图片
            debugger;
          },
        },
        attached() {
          this.loadImg();
        },
        detached() {},
      };
    };
  </script>
</template>
