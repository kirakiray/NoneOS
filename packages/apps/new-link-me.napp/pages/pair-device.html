<template page>
  <l-m src="/packages/comps/local-icon/local-icon.html"></l-m>
  <style>
    :host {
      display: block;
    }
  </style>
  <div style="display: flex; align-items: center">
    <n-local-icon
      name="loading"
      style="margin-right: 8px; display: block"
    ></n-local-icon>
    等待对方确认中...
  </div>
  <script>
    export default async ({ load }) => {
      const { createUser } = await load("/packages/new-user/main.js");
      const user = await createUser();

      return {
        data: {},
        attached() {
          this._off = user.bind("receive-data", (e) => {
            const { data, fromUserId } = e.detail;

            if (data.goal === "pair-confirm") {
              this.clicked = true;
            }

            const { inviteCode } = data;

            let sessionInviteCode = sessionStorage.getItem(
              "__sessionInviteCode"
            );

            if (inviteCode !== sessionInviteCode) {
              // TODO: 邀请码不匹配，提示用户可能有攻击
              debugger;
              return;
            }

            debugger;
          });
        },
        detached() {
          this._off();
        },
      };
    };
  </script>
</template>
