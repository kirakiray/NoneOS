<template component>
  <style>
    :host {
      position: relative;
      display: block;
      margin: 0 auto;
      max-width: 800px;
      width: 100%;
    }

    .dragovering-mark {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 2px;
      background-color: var(--md-sys-color-primary);
      opacity: 0;
    }
    .dragovering-mark.show {
      opacity: 1;
    }

    .title {
      font-size: 40px;
      font-weight: 700;
      box-sizing: border-box;
      margin: 0 6px;
      width: 100%;
      outline: none;
      background-color: transparent;
      -webkit-appearance: none;
      appearance: none;
      border: none;
      color: inherit;
    }
  </style>
  <div style="height: 100px"></div>
  <o-if :value="!inTranslate">
    <input
      class="title"
      type="text"
      sync:value="itemData.title"
      on:click="$event.stopPropagation()"
      style="margin-bottom: 16px"
      on:keydown="titleKeyDown"
      :placeholder="desc.pageTitlePlaceholder"
    />
  </o-if>
  <o-else>
    <div class="title">
      <div :text="translateContent" style="display: contents"></div>
    </div>
  </o-else>
  <div class="dragovering-mark" class:show="dragovering"></div>
  <script>
    import { localizedObject } from "/packages/i18n/localized-object.js";

    export default async ({ load }) => {
      const { ask, clearAsk } = await load("/packages/ai/main.js");

      return {
        tag: "lumi-page-title",
        data: {
          dragovering: false,
          itemData: {},
          desc: {},
          translateContent: "", // 翻译后的文本
          inTranslate: false, // 翻译中
          inTranslateLang: "", // 翻译的语言
        },
        proto: {
          switchOtherLang(lang) {
            debugger;
          },
          titleKeyDown(e) {
            if (e.key === "Enter") {
              // 如果第一个元素不是空元素，则添加空元素后聚焦
              let firstBlock = this[0];

              if (!firstBlock.itemData.value.trim()) {
                firstBlock.focus();
                return;
              }

              this.itemData.content.unshift({
                type: "paragraph",
                value: "",
              });

              setTimeout(() => {
                this[0].focus();
              }, 10);
            }
          },
          focus() {
            this.shadow.$(".title").ele.focus();
          },
        },
        attached() {
          this.desc = localizedObject({
            pageTitlePlaceholder: {
              cn: "页面标题",
              en: "Page title",
              ja: "ページタイトル",
            },
          });
        },
        detached() {
          this.itemData = {};
          this.desc._clear();
          this.desc = {};
        },
      };
    };
  </script>
</template>
