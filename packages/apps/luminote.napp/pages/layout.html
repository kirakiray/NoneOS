<template page>
  <l-m src="/packages/pui/list/list.html"></l-m>
  <l-m src="/packages/pui/button/button.html"></l-m>
  <l-m src="/packages/comps/local-icon/local-icon.html"></l-m>
  <style>
    :host {
      display: block;
      height: 100%;
      background-color: var(--md-sys-color-surface-variant);
    }

    .container {
      display: flex;
      height: 100%;
    }

    .main {
      position: relative;
      flex: 1;
      height: 100%;
    }

    .left {
      width: 260px;
      /* color: var(--md-sys-color-on-normal-container);
      background-color: var(--md-sys-color-normal-container); */
      border-right: var(--md-sys-color-normal-container) solid 1px;
      /* border-right: #aaa solid 1px; */
    }

    /* .right {
      width: 200px;
      border-left: #bbb solid 1px;
    } */
  </style>

  <div class="container">
    <div class="left">
      <div style="height: 80px"></div>
      <p-list>
        <p-list-item collapse-childs="open" button="suffix">
          <n-local-icon
            name="persion"
            slot="prefix"
            style="display: block; margin-right: 4px; font-size: 18px"
          ></n-local-icon>
          我的笔记
          <i toggle-collapse slot="suffix" style="display: none"></i>
          <p-button
            size="small"
            icon
            slot="suffix"
            variant="text"
            on:click="handleAddNote"
            style="z-index: 3; position: absolute; right: 16px"
          >
            <n-local-icon name="add"></n-local-icon>
          </p-button>

          <p-list slot="childs" style="--ladder-left: 8px">
            <o-fill
              :value="articles"
              name="list-item"
              fill-key="_dataId"
            ></o-fill>
          </p-list>
        </p-list-item>
      </p-list>
    </div>

    <template name="list-item">
      <p-list-item
        button
        attr:active-item=" $data._dataId === $host.currentArticleDataId"
        on:click="$host.handleClickArticle($data)"
      >
        <n-local-icon
          name="article"
          slot="prefix"
          style="display: block; margin-right: 4px; font-size: 18px"
        ></n-local-icon>
        {{$data.title}}
      </p-list-item>
    </template>

    <div class="main" on:active-article="handleActiveArticle">
      <slot></slot>
    </div>
    <!-- <div class="right"></div> -->
  </div>
  <script>
    export default async ({ load }) => {
      return {
        data: {
          articles: [],
          currentArticleDataId: null,
        },
        proto: {
          handleClickArticle(data) {
            this.app.goto(`./pages/note.html?article_id=${data._dataId}`);
          },
          handleAddNote(e) {
            e.stopPropagation();
          },
          handleActiveArticle(e) {
            this.currentArticleDataId = e.data.articleId;
          },
        },
        attached() {
          this.app._articleData &&
            this.app._articleData.then((articleData) => {
              this.articles = articleData.main;
            });
        },
        detached() {
          this.app._articleData &&
            this.app._articleData.then((articleData) => {
              articleData.disconnect();
            });
        },
      };
    };
  </script>
</template>
