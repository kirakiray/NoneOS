<template component>
  <l-m src="/packages/pui/list/list.html"></l-m>
  <l-m src="/packages/pui/input/input.html"></l-m>
  <l-m src="/packages/pui/dialog/dialog.html"></l-m>
  <l-m src="./add-server-form.html"></l-m>
  <style>
    :host {
      display: flex;
      flex-direction: column;
    }
  </style>
  <div class="list">
    <o-page src="./list-item/lmstudio.html" :item="aiSetting.lmstudio"></o-page>
    <o-if :value="aiSetting.otherAI">
      <o-fill :value="aiSetting.otherAI">
        <div>
          <o-if :value="$data.name === 'Ollama'">
            <o-page src="./list-item/ollama.html" :item="$data"></o-page>
          </o-if>
        </div>
      </o-fill>
    </o-if>
    <div style="margin-top: 10px">
      <p-button variant="outlined" size="small" on:click="showAddServer = true">
        添加更多本机AI
      </p-button>
    </div>
    <p-dialog :open="showAddServer" on:click-mask="showAddServer = false">
      <ai-add-server-form
        on:success="showAddServer = false"
      ></ai-add-server-form>
    </p-dialog>
  </div>
  <script>
    export default async ({ load }) => {
      const { getAISetting } = await load("./custom-data.js");
      const aiSetting = await getAISetting();

      return {
        tag: "ai-list",
        data: {
          showAddServer: false,
          aiSetting: {
            // lmstudio: {},
          },
        },
        proto: {
          initLmstudio() {
            if (!this.aiSetting.lmstudio) {
              this.aiSetting.lmstudio = {
                port: 1234,
              };
            }
          },
        },
        attached() {
          this.aiSetting = aiSetting;

          this.initLmstudio();
        },
        detached() {
          this.aiSetting = {};
        },
      };
    };
  </script>
</template>
