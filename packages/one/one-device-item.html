<template component>
  <l-m src="/packages/pui/list/list.html"></l-m>
  <l-m src="/packages/comps/user-avatar.html"></l-m>
  <l-m src="/packages/comps/user-state.html"></l-m>
  <style>
    :host {
      display: block;
      padding: 4px 12px;
    }

    .container {
      display: flex;
      align-items: center;
    }

    n-user-avatar {
      display: block;
      width: 24px;
      height: 24px;
    }

    .user-name {
      font-size: 14px;
      margin-left: 8px;
    }
  </style>
  <div class="container">
    <n-user-avatar :userid="userId"></n-user-avatar>
    <div class="user-name">{{userName}}</div>
    <n-user-state :userid="userId" style="margin-left: 8px"></n-user-state>
  </div>
  <script>
    export default async ({ load }) => {
      const { createUser } = await load("/packages/user/main.js");
      const localUser = await createUser();

      return {
        tag: "n-one-device-item",
        data: {
          userId: null,
          userName: "",
        },
        watch: {
          userId() {
            this.initUser();
          },
        },
        proto: {
          async initUser() {
            if (!this.userId) {
              return;
            }

            const remoteUser = await localUser.connectUser(this.userId);

            const info = await remoteUser.info();
            this.userName = info.name;

            setTimeout(() => {
              remoteUser.ping();
            }, 300);
          },
        },
      };
    };
  </script>
</template>
