!function(){"use strict";const e=async e=>{const t=await navigator.storage.getDirectory(),a=e.split("/");let s="",n=t;for(;a.length>1;){const e=a.shift();s+=`${e}/`;const t=await n.getDirectoryHandle(e).catch((()=>null));if(!t)throw new Error(`目录 ${s} 不存在`);n=t}const r=await n.getFileHandle(a[0]).catch((()=>null));if(!r)throw new Error(`文件 ${e} 不存在`);return r},t=e=>{switch(e){case"html":case"htm":case"txt":case"md":return"text/plain; charset=utf-8";case"js":case"mjs":return"application/javascript; charset=utf-8";case"json":return"application/json; charset=utf-8";case"css":return"text/css; charset=utf-8";case"xml":return"application/xml; charset=utf-8";case"svg":return"image/svg+xml; charset=utf-8";case"csv":return"text/csv; charset=utf-8";case"ics":return"text/calendar; charset=utf-8";case"pdf":return"application/pdf; charset=utf-8";case"doc":case"docx":return"application/msword; charset=utf-8";case"xls":case"xlsx":return"application/vnd.ms-excel; charset=utf-8";case"ppt":case"pptx":return"application/vnd.ms-powerpoint; charset=utf-8";case"zip":return"application/zip; charset=utf-8";case"gz":return"application/gzip; charset=utf-8";case"tar":return"application/x-tar; charset=utf-8";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"gif":return"image/gif";case"bmp":case"bmp":return"image/bmp";case"ico":return"image/x-icon";case"webp":return"image/webp";case"mp3":return"audio/mpeg";case"wav":return"audio/wav";case"mp4":case"m4v":return"video/mp4";case"mov":return"video/quicktime";case"avi":return"video/x-msvideo";default:return"application/octet-stream"}};const a=async t=>{let a;t=t.replace(/^\//,"");try{a=await e(t),a=await a.getFile()}catch(e){a=await fetch(t).then((e=>e.blob()))}return a},s=async e=>{const{request:t}=e,{pathname:s,origin:n,searchParams:r}=new URL(t.url);let c="icon.svg";e.respondWith((async()=>{let e="App";try{const t=await a(`${s}app.json`);let n=await t.text();n=JSON.parse(n),c=n.icon||c,e=n.name||s.split("/").filter((e=>/\.napp$/.test(e))).slice(-1)[0].replace(/\.napp$/,"")}catch(e){}return new Response(`<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <title>${e}</title>\n    <link rel="icon" href="./${c}">\n    <link rel="stylesheet" href="/packages/others/colors.css" pui-colors />\n    <script src="/packages/libs/ofa/ofa.js#debug"><\/script>\n    <script src="/packages/libs/ofa/router.min.js"><\/script>\n    <script src="/packages/pui/public/init.js" type="module"><\/script>\n    <script src="/packages/none-os/init.js" type="module"><\/script>\n    <style>\n      body{\n        background-color: var(--md-sys-color-surface);\n        color: var(--md-sys-color-on-surface);\n      }\n\n      body {\n        font: 400 1em/1.8 -apple-system, BlinkMacSystemFont, Segoe UI,\n          Microsoft Yahei, Helvetica, Arial, sans-serif, Apple Color Emoji,\n          Segoe UI Emoji;\n      }\n    </style>\n  </head>\n  <body>\n    <o-router fix-body>\n      <o-app src="./app-config.js"></o-app>\n    </o-router>\n  </body>\n</html>`,{status:200,headers:{"content-type":"text/html; charset=utf-8"}})})())};self.addEventListener("fetch",(n=>{const{request:r}=n,{pathname:c,origin:i,searchParams:o}=new URL(r.url);location.origin===i&&(/^\/\$/.test(c)?(a=>{const{request:s}=a;let{pathname:n,origin:r,searchParams:c}=new URL(s.url);n=decodeURIComponent(n);const i=n.split("/"),o=[i[1].replace("$",""),...i.slice(2)].join("/");a.respondWith((async()=>{try{const a=await e(o),s=n.split(".").pop();return new Response(await a.getFile(),{status:200,headers:{"Content-Type":t(s)}})}catch(e){return new Response(e.stack||e.toString(),{status:400})}})())})(n):/^\/packages/.test(c)&&async function(e){const{request:n}=e,{pathname:r,origin:c,searchParams:i}=new URL(n.url);/\.napp\/$/.test(r)?s(e):e.respondWith((async()=>{const e=await a(r),s=r.split(".").pop();return new Response(e,{status:200,headers:{"Content-Type":t(s)}})})())}(n))})),self.addEventListener("install",(()=>{self.skipWaiting(),console.log("NoneOS installation successful")})),self.addEventListener("activate",(()=>{self.clients.claim(),console.log("NoneOS server activation successful")}))}();
