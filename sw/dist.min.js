!function(){"use strict";const e=async e=>{const t=await navigator.storage.getDirectory(),s=e.split("/");let a="",n=t;for(;s.length>1;){const e=s.shift();a+=`${e}/`;const t=await n.getDirectoryHandle(e).catch((()=>null));if(!t)throw new Error(`目录 ${a} 不存在`);n=t}const r=await n.getFileHandle(s[0]).catch((()=>null));if(!r)throw new Error(`文件 ${e} 不存在`);return r},t=e=>{switch(e){case"html":case"htm":case"txt":case"md":return"text/plain; charset=utf-8";case"js":case"mjs":return"application/javascript; charset=utf-8";case"json":return"application/json; charset=utf-8";case"css":return"text/css; charset=utf-8";case"xml":return"application/xml; charset=utf-8";case"svg":return"image/svg+xml; charset=utf-8";case"csv":return"text/csv; charset=utf-8";case"ics":return"text/calendar; charset=utf-8";case"pdf":return"application/pdf; charset=utf-8";case"doc":case"docx":return"application/msword; charset=utf-8";case"xls":case"xlsx":return"application/vnd.ms-excel; charset=utf-8";case"ppt":case"pptx":return"application/vnd.ms-powerpoint; charset=utf-8";case"zip":return"application/zip; charset=utf-8";case"gz":return"application/gzip; charset=utf-8";case"tar":return"application/x-tar; charset=utf-8";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"gif":return"image/gif";case"bmp":case"bmp":return"image/bmp";case"ico":return"image/x-icon";case"webp":return"image/webp";case"mp3":return"audio/mpeg";case"wav":return"audio/wav";case"mp4":case"m4v":return"video/mp4";case"mov":return"video/quicktime";case"avi":return"video/x-msvideo";default:return"application/octet-stream"}},s={packageUseOnline:!1,debugMode:!1};const a=async t=>{let a;t=t.replace(/^\//,"");try{if(s.packageUseOnline||s.debugMode)throw new Error("");a=await e(t),a=await a.getFile()}catch(e){a=await fetch(t).then((e=>e.blob()))}return a},n=async e=>{const{request:t}=e,{pathname:s,origin:n,searchParams:r}=new URL(t.url);let c="icon.svg";e.respondWith((async()=>{let e="App";try{const t=await a(`${s}app.json`);let n=await t.text();n=JSON.parse(n),c=n.icon||c,e=n.name||s.split("/").filter((e=>/\.napp$/.test(e))).slice(-1)[0].replace(/\.napp$/,"")}catch(e){}return new Response(`<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <meta name="full-screen" content="yes">\n    <meta name="apple-touch-fullscreen" content="yes">\n    <title>${e}</title>\n    <link rel="icon" href="./${c}">\n    <link rel="stylesheet" href="/packages/others/colors.css" pui-colors />\n    <script src="/packages/libs/ofa/ofa.js#debug"><\/script>\n    <script src="/packages/libs/ofa/router.min.js"><\/script>\n    <script src="/packages/pui/public/init.js" type="module"><\/script>\n    <script src="/packages/none-os/init.js" type="module"><\/script>\n    <style>\n      body{\n        background-color: var(--md-sys-color-surface);\n        color: var(--md-sys-color-on-surface);\n      }\n\n      body {\n        font: 16px / 24px ui-sans-serif, -apple-system, "system-ui",\n          "Segoe UI Variable Display", "Segoe UI", Helvetica, "PingFang SC",\n          "Microsoft YaHei", Helvetica, "Apple Color Emoji", Arial, sans-serif,\n          "Segoe UI Emoji", "Segoe UI Symbol";\n      }\n    </style>\n  </head>\n  <body>\n    <o-router fix-body>\n      <o-app src="./app-config.js"></o-app>\n    </o-router>\n  </body>\n</html>`,{status:200,headers:{"content-type":"text/html; charset=utf-8"}})})())};let r;self.addEventListener("fetch",(c=>{const{request:i}=c,{pathname:o,origin:p,searchParams:l}=new URL(i.url);location.origin===p&&(/^\/\$/.test(o)?(s=>{const{request:a}=s;let{pathname:n,origin:r,searchParams:c}=new URL(a.url);n=decodeURIComponent(n);const i=n.split("/"),o=[i[1].replace("$",""),...i.slice(2)].join("/");s.respondWith((async()=>{try{const s=await e(o),a=n.split(".").pop();return new Response(await s.getFile(),{status:200,headers:{"Content-Type":t(a)}})}catch(e){return new Response(e.stack||e.toString(),{status:400})}})())})(c):/^\/packages/.test(o)&&async function(e){const{request:r}=e,{pathname:c,origin:i,searchParams:o}=new URL(r.url);/\.napp\/$/.test(c)?n(e):s.packageUseOnline||s.debugMode||e.respondWith((async()=>{const e=await a(c),s=c.split(".").pop();return new Response(e,{status:200,headers:{"Content-Type":t(s)}})})())}(c)),"/"!==o||s.packageUseOnline||s.debugMode||c.respondWith((async()=>{try{const t=await e("packages/index.html");if(t)return new Response(await t.getFile(),{headers:{"Content-Type":"text/html;charset=utf-8"}})}catch(e){console.error(e)}return fetch(i)})()),"/package-use-online"===o?(clearTimeout(r),s.packageUseOnline=!0,c.respondWith(new Response("package use online")),r=setTimeout((()=>{s.packageUseOnline=!1}),3e3)):"/package-use-local"===o?(clearTimeout(r),s.packageUseOnline=!1,c.respondWith(new Response("package use local"))):"/open-debug-mode"===o?(s.debugMode=!0,c.respondWith(new Response("debug mode open"))):"/close-debug-mode"===o?(s.debugMode=!1,c.respondWith(new Response("debug mode close"))):"/get-configs"===o&&c.respondWith(new Response(JSON.stringify(s)))})),self.addEventListener("install",(()=>{self.skipWaiting(),console.log("NoneOS installation successful")})),self.addEventListener("activate",(()=>{self.clients.claim(),console.log("NoneOS server activation successful")}))}();
